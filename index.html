<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NPS - CearaGPS</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen flex flex-col bg-gradient-to-tr from-[#00708B] to-[#003041]">

    <!-- HEADER -->
    <header class="w-screen h-32 flex items-center justify-center">
        <img src="logocgps.png" class="block sm:max-w-md lg:max-w-2xl object-contain">
    </header>

    <!-- MAIN -->
    <main class="flex-1 flex items-center justify-center px-2 sm:px-4 overflow-y-auto pb-16">
        <!-- <div class="w-full max-w-[1100px] mx-auto flex flex-col gap-8"> -->
        <div class="w-full max-w-[420px] sm:max-w-[560px] md:max-w-[760px] lg:max-w-[900px] mx-auto flex flex-col gap-6 px-4">

            <!-- CARD IDENTIFICA√á√ÉO -->
            <div id="card-identificacao"
                class="w-full bg-[#ECECEC] rounded-2xl shadow-2xl p-6 text-center">

                <h1 class="text-[#00465D] font-semibold text-2xl mb-8">
                    Informe seu Nome e Telefone (WhatsApp)
                </h1>

                <div class="grid grid-cols-1 gap-6 max-w-3xl mx-auto">

                    <!-- Nome -->
                    <input id="nome" type="text" placeholder="Seu nome (opcional)"
                        class="w-full p-4 rounded-xl border border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-[#FF4302]" />

                    <!-- Telefone -->
                    <div class="relative">
                        <input id="telefone" type="text" inputmode="numeric"
                            placeholder="(DDD) WhatsApp"
                            class="w-full p-4 rounded-xl border border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-[#FF4302]" />

                        <span
                            class="absolute left-4 top-1/2 -translate-y-1/2 text-[#25D366] text-xl select-none">
                            üü¢
                        </span>

                        <p id="erro-telefone"
                            class="hidden mt-2 text-sm text-red-600 font-medium text-center">
                            Informe um telefone celular v√°lido com DDD.
                        </p>
                    </div>
                </div>

                <button onclick="confirmarIdentificacao()"
                    class="mt-8 w-64 h-14 bg-[#FF4302] text-white text-lg rounded-xl font-semibold transition hover:opacity-90 active:scale-95">
                    Confirmar
                </button>
            </div>

            <!-- CARD NPS -->
            <div id="card-nps" class="hidden w-full bg-[#ECECEC] rounded-2xl shadow-2xl p-6 text-center">
                <h1 class="text-[#00465D] text-xl md:text-2xl font-semibold mb-8">
                    De 0 a 10, como foi sua experi√™ncia?
                </h1>

                <p class="text-sm text-[#00465D] mb-4 flex justify-between">
                    <span>0 = Insatisfeito</span>
                    <span>10 = Totalmente Satisfeito</span>
                </p>

                <div id="grade-notas" class="grid grid-cols-11 gap-3 justify-center"></div>
            </div>

        </div>
    </main>

    <!-- TOAST -->
    <div id="toast"
        class="hidden fixed bottom-40 right-8 bg-[#00465D] text-white px-6 py-4 rounded-xl shadow-2xl text-sm z-50 w-72">
        <p class="mb-2">Avalia√ß√£o enviada com sucesso!</p>
        <div class="w-full h-1 bg-white/30 rounded overflow-hidden">
            <div id="toast-progress" class="h-full bg-[#FF4302] toast-progress"></div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="w-screen h-32 bg-[#FF4302]">
        <div class="h-32 w-full bg-no-repeat bg-contain bg-center"
            style="background-image: url('footer.png');"></div>
    </footer>

    <!-- JS -->
    <script>
        const webhookUrl = "https://webhook.gpsceara.shop/webhook/whnps";

        let nomeInformado = "";
        let telefoneInformado = "";
        let notaSelecionada = null;

        // M√°scara telefone celular BR
        document.getElementById("telefone").addEventListener("input", (e) => {
            let v = e.target.value.replace(/\D/g, "");
            const erro = document.getElementById("erro-telefone");

            erro.classList.add("hidden");
            e.target.classList.remove("border-red-500");

            if (v.length > 11) v = v.slice(0, 11);

            if (v.length >= 7) {
                v = v.replace(/^(\d{2})(\d{5})(\d{0,4})$/, "($1) $2-$3");
            } else if (v.length >= 3) {
                v = v.replace(/^(\d{2})(\d+)/, "($1) $2");
            } else {
                v = v.replace(/^(\d*)$/, "($1");
            }

            e.target.value = v;
        });

        function validarTelefone(valor) {
            const digits = valor.replace(/\D/g, "");
            return digits.length === 11;
        }

        function confirmarIdentificacao() {
            nomeInformado = document.getElementById("nome").value.trim();
            const telInput = document.getElementById("telefone");
            const erro = document.getElementById("erro-telefone");

            if (!validarTelefone(telInput.value)) {
                erro.classList.remove("hidden");
                telInput.classList.add("border-red-500");
                return;
            }

            telefoneInformado = telInput.value;

            document.getElementById("card-identificacao").classList.add("hidden");
            document.getElementById("card-nps").classList.remove("hidden");

            gerarNotas();
        }

        function gerarNotas() {
            const container = document.getElementById("grade-notas");
            container.innerHTML = "";

            for (let i = 0; i <= 10; i++) {
                container.innerHTML += `
                    <button onclick="selecionarNota(${i})"
                        class="card-nps nps-${i}">
                        ${i}
                    </button>`;
            }
        }

        function selecionarNota(nota) {
            notaSelecionada = nota;

            document.getElementById("card-nps").innerHTML = `
                <h1 class="text-[#00465D] text-xl md:text-2xl font-semibold mb-4">
                    Deseja deixar alguma observa√ß√£o?
                </h1>

                <textarea id="observacao" placeholder="Escreva sua observa√ß√£o aqui..."
                    class="w-full p-4 rounded-xl border border-gray-300 mb-6 focus:outline-none focus:ring-2 focus:ring-[#FF4302]"></textarea>

                <button onclick="finalizar()"
                    class="bg-[#FF4302] text-white px-8 py-3 rounded-xl font-semibold transition hover:opacity-90 active:scale-95">
                    Finalizar
                </button>
            `;
        }

        function horaavaliacao() {
            return new Date().toLocaleString("sv-SE", {
                timeZone: "America/Fortaleza"
            }).replace(" ", "T");
        }

        function finalizar() {
            const obs = document.getElementById("observacao")?.value || "";

            fetch(webhookUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    nome: nomeInformado,
                    telefone: telefoneInformado,
                    nota_nps: notaSelecionada,
                    observacao: obs,
                    hora_avaliacao: horaavaliacao()
                })
            });

            document.getElementById("card-nps").innerHTML = `
                <h1 class="text-[#00465D] text-xl md:text-2xl font-semibold">
                    Obrigado pela sua avalia√ß√£o!
                </h1>
                <p class="mt-4 text-[#00465D]">
                    Sua opini√£o √© muito importante para n√≥s.
                </p>
            `;

            const toast = document.getElementById("toast");
            const progress = document.getElementById("toast-progress");

            progress.classList.remove("toast-progress");
            void progress.offsetWidth;
            progress.classList.add("toast-progress");

            toast.classList.remove("hidden");

            setTimeout(() => location.reload(), 3000);
        }
    </script>

    <!-- STYLE (INALTERADO) -->
    <style>
        .card-nps {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform .15s ease, box-shadow .15s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, .15);
        }

        .card-nps:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 18px rgba(0, 0, 0, .25);
        }

        .nps-0 { background: #ef4444; }
        .nps-1 { background: #f05252; }
        .nps-2 { background: #f97316; }
        .nps-3 { background: #fb923c; }
        .nps-4 { background: #facc15; }
        .nps-5 { background: #eab308; }
        .nps-6 { background: #d9f99d; }
        .nps-7 { background: #a3e635; }
        .nps-8 { background: #4ade80; }
        .nps-9 { background: #22c55e; }
        .nps-10 { background: #16a34a; }

        .toast-progress {
            width: 100%;
            animation: progressBar 3s linear forwards;
        }

        @keyframes progressBar {
            from { width: 100%; }
            to { width: 0%; }
        }
    </style>

</body>
</html>
